<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec11 String</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>


            <section>
                <h2>Why Text?</h2>
                <ul>
                    <li>Internet/cloud is the largest data warehouse</li>
                    <li>Best to disseminate data and results</li>
                    <li>Web pages are data themselves</li>
                </ul>
            </section>

            <section>
                <h2>Other Text Data</h2>
                <ul>
                    <li>Books, newspapers</li>
                    <li>Phone texts, messages</li>
                    <li>Records</li>
                    <li>Measures by electronic devices</li>
                </ul>
            </section>

            <section>
                <h2>R Functions</h2>
                <ul>
                    <li>
                        <emphcode>grep</emphcode> searches substring <emph>pattern</emph>
                    </li>
                    <li>
                        <emphcode>nchar</emphcode> finds length
                    </li>
                    <li>
                        <emphcode>paste</emphcode> concate strings
                    </li>
                    <li>
                        <emphcode>sprintf</emphcode> formatted printing
                    </li>
                    <li>
                        <emphcode>substr</emphcode> sub-strings extraction by indices
                    </li>
                    <li>
                        <emphcode>strsplit</emphcode> split by delimiter
                    </li>
                    <li>
                        <emphcode>regexpr</emphcode> finds first instance of pattern
                    </li>
                    <li>
                        <emphcode>gregexpr</emphcode> finds all instances of pattern
                    </li>
                </ul>
            </section>


            <section>
                <h2>Case</h2>
                <img src="img/us_census_data_screenshot.png" width="800px" alt="">
                <a href="https://www2.census.gov/acs2013_3yr/pums/">https://www2.census.gov/acs2013_3yr/pums/</a>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    a &lt;- scan("http://www2.census.gov/acs2013_3yr/pums/", "character")
                    ## remove junks
                    a &lt;- a[grep("csv", a)]                  
                    ## extract the file names
                    a &lt;-  substring(a, 7, 17)                    
                    ## get the links to the zip files
                    baseurl &lt;- "http://www2.census.gov/acs2013_3yr/pums/"
                    aurl &lt;- paste(baseurl, a,sep="")                    
                    ## Download the files automatically
                    for (i in seq_along(a)) {
                        print(paste0("Downloading ", a[i]))
                        download.file(aurl[i], a[i])
                        ## To avoid overwhelming the web traffic,
                        ## Add pauses between downloads to mimic human clicking 
                        Sys.sleep(10)
                    }
                </code></pre>
            </section>

            <section>
                <h2>Strategy Summary</h2>
                <ul>
                    <li>Retrieve the html text</li>
                    <li>Examine the patterns for the wanted info</li>
                    <li>Trial and error to extract info, strip junks and match patterns</li>
                    <li>Automatic downloading (with pauses)</li>
                </ul>
            </section>

            <section>
                <h1>Regular Expressions</h1>
            </section>

            <section>
                <h2>RE</h2>
                <ul>
                    <li>Formulation of search patterns</li>
                    <li>General strategy implmented in almost all modern computing languages</li>
                    <li>Enable efficient expression of patterns</li>
                </ul>
            </section>

            <section data-state="dna">
                <h2>Example</h2>
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/DNA_Structure%2BKey%2BLabelled.pn_NoBB.png/1920px-DNA_Structure%2BKey%2BLabelled.pn_NoBB.png"
                    width="50%" alt="">
                <p>DNA consists of A, T, C, G, usually the format data stored</p>
                <style>
                    .dna credit:after {
                        content: "https://en.wikipedia.org/wiki/DNA";
                    }
                </style>
            </section>

            <section>
                <h2>Example</h2>
                <ul>
                    <li>Given a long text string <emphcode>myDNA</emphcode>
                    </li>
                    <li> Suppose we want to look for DNA segments within myDNA that start and end like “AT...CG”, where
                        ... stands for any number of T’s
                        <ul>
                            <li>examples: GCATCG, GCATTCG, GCATTTCG, ...
                            </li>
                        </ul>
                    </li>
                    <li>How do write this in R?</li>
                </ul>
            </section>

            <section>
                <h2>Naive Implementation</h2>
                <pre><code data-trim data-noescape class="language-r">
                    for (i in 1:length(myDNA)) {
                        if (myDNA[i,(i+3)] == “ATCG” ||
                                myDNA[i,(i+4)] == “ATTCG” ||
                                    myDNA[i,(i+5)] == “ATTTCG” ||
                                            .....
                                        myDNA[i,(i+9)] == “ATTTTTTTCG”) {
                                            print(paste(“Pattern found at”, i))  }  }
                </code></pre>
            </section>

            <section>
                <h2>Drawbacks</h2>
                <ul>
                    <li>The coding effort of exhausting the cases
                    </li>
                    <li>Only works for a short list of simple cases
                    </li>
                    <li>Difficult to read and modify codes
                    </li>
                    <li>Slow to run for large data</li>
                </ul>
            </section>


            <section>
                <h2>RE Solution</h2>
                <pre><code data-trim data-noescape class="language-r">
                    grep("AT+CG", myDNA)
                </code></pre>
            </section>


            <section>
                <h2>Describing Patterns</h2>
                <ul>
                    <li>“Generic” string to describe the pattern, e.g. "AT+CG"</li>
                    <li>Special characters, e.g. + means 1 or more repeats of the previous one</li>
                    <li>Similar across languages with minor modifications in R </li>
                </ul>
            </section>

            <section>
                <h2>RE Punctuations</h2>
                <ul>
                    <li>“.”: any characters; “\\.”: you really mean “dot”
                    </li>
                    <li>“[]”: any listed will match
                        <ul>
                            <li>“[ab]”: a or b; “[a-d]”: either a, b, c, or d
                            </li>
                        </ul>
                    </li>
                    <li>“^”: beginning of line
                        <ul>
                            <li>Exception: “[^a-d]”: anything but a, b, c, or d
                            </li>
                        </ul>
                    </li>
                    <li>“$”: end of line
                    </li>
                    <li>“*”: zero or one more repeats
                    </li>
                    <li>“+”: one or more repeats
                    </li>
                    <li>“()”: matched substring</li>
                </ul>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    myDNA <- c("ATCG", "CCATCG", "ATGCG", "ATTTCCG", 
                              "ATTTTTTCGGGG",  "ATTCGGGATCG")
                    myDNA[grep(".*A.*", myDNA)]
                </code></pre>
                <p class="fragment fade-up">Output: [1] "ATCG" ... [6] "ATTCGGGATCG" </p>
                <pre><code data-trim data-noescape class="language-r">
                    myDNA[grep(".+A.+", myDNA)]
                </code></pre>
                <p class="fragment fade-up">Output: [1] "CCATCG" "ATTCGGGATCG" </p>
                <pre><code data-trim data-noescape class="language-r">
                    myDNA[grep("^[AT]+.*[G]+$", myDNA)]
                </code></pre>
                <p class="fragment fade-up">Output: [1] "ATCG" "ATGCG" "ATTTCCG" "ATTTTTTCGGGG" "ATTCGGGATCG" </p>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > myDNA <- c("ATCG", "CCATCG", "ATGCG", "ATTTCCG", 
                                "ATTTTTTCGGGG",  "ATTCGGGATCG")
                    > sub("ATT?CG", "haha", myDNA)
                    [1] "haha"         "CChaha"       "ATGCG"        "ATTTCCG"      "ATTTTTTCGGGG"
                    [6] "hahaGGATCG"  
                </code></pre>
                <pre><code data-trim data-noescape class="language-r">
                    sub("(AT+CG)", "\\1_\\1_haha", myDNA)
                </code></pre>
                <p>Output</p>
                <pre class="fragment fade-up"><code data-trim data-noescape class="language-r">
                    [1] "ATCG_ATCG_haha"              "CCATCG_ATCG_haha"           
                    [3] "ATGCG"                       "ATTTCCG"                    
                    [5] "ATTTTTTCG_ATTTTTTCG_hahaGGG" "ATTCG_ATTCG_hahaGGATCG"     
                </code></pre>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > myDNA <- c("ATCG", "CCATCG", "ATGCG", "ATTTCCG", 
                                "ATTTTTTCGGGG",  "ATTCGGGATCG")
                    > strsplit(myDNA, "AT+CG")
                    [[1]]
                    [1] ""
                    ... 
                    [[5]]
                    [1] ""    "GGG"
                    
                    [[6]]
                    [1] ""   "GG"
                </code></pre>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > regexpr("AT+CG", myDNA)
                    [1]  1  3 -1 -1  1  1
                    attr(,"match.length")
                    [1]  4  4 -1 -1  9  5
                    attr(,"index.type")
                    [1] "chars"
                    attr(,"useBytes")
                    [1] TRUE                   
                </code></pre>
                <pre><code data-trim data-noescape class="language-r">
                    > gregexpr("AT+CG", myDNA)
                    [[1]]
                    [1] 1
                    attr(,"match.length")
                    [1] 4
                    attr(,"index.type")
                    [1] "chars"
                    attr(,"useBytes")
                    [1] TRUE              

                    [[2]]
                    [1] 3
                    attr(,"match.length")
                    [1] 4
                    attr(,"index.type")
                    [1] "chars"
                    attr(,"useBytes")
                    [1] TRUE                              
                </code></pre>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- "http://en.wikipedia.org/wiki/Data_science"
                    > m <- regexec("^(([^:]+)://)?([^:/]+)(/[^/]+)(/.*)", x)
                    > m
                    [[1]]
                    [1]  1  1  1  8 24 29
                    attr(,"match.length")
                    [1] 41  7  4 16  5 13
                    ...
                    
                    > regmatches(x, m)
                    [[1]]
                    [1] "http://en.wikipedia.org/wiki/Data_science"
                    [2] "http://"                                  
                    [3] "http"                                     
                    [4] "en.wikipedia.org"                         
                    [5] "/wiki"                                    
                    [6] "/Data_science"                            
                </code></pre>
            </section>

            <section>
                <h2>Strategy Summary</h2>
                <ul>
                    <li>Identify the goal of RE</li>
                    <li>Choose right function</li>
                    <li>Start with broad matches and refine
                        <ul>
                            <li>RE by default find longest substring matching patterns</li>
                            <li>Refine match by editing punctuations</li>
                        </ul>
                    </li>
                </ul>
            </section>


            <section>
                <h1>Web Scraping</h1>
            </section>

            <!-- <section>
                <img src="img/aapl_yahoo_finance.png" alt="">
                <p>https://finance.yahoo.com/quote/aapl?p=aapl</p>
            </section>

            <section>
                <h2>HTTP(S) Request</h2>
                <ul>
                    <li>URL for AAPL: https://finance.yahoo.com/quote/aapl?p=aapl
                    </li>
                    <li>This represents HTTP request (GET)
                    </li>
                    <li>Can include parameters after the question mark
                        <ul>
                            <li>“p=”: stock=; “+”: to replace spaces in paras
                            </li>
                        </ul>
                    </li>
                    <li>Ref: http://www.w3schools.com/tags/ref_httpmethods.asp</li>
                </ul>
            </section> -->

            <section>
                <iframe src="https://en.wikipedia.org/wiki/COVID-19" width="100%" height="600px"
                    frameborder="0"></iframe>
                <p>https://en.wikipedia.org/wiki/COVID-19</p>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    install.packages("RCurl", repo = 'https://cloud.r-project.org')
                    library(RCurl)
                    a <- getURL(theurl)
                    ## format a (e.g. adding line breaks) for better readability
                    a <- readLines(tc <- textConnection(a)); close(tc)
                    a[grep("IFR estimate per age group", a)]                  
                </code></pre>
                <p>Output</p>
                <pre><code data-trim data-noescape class="language-r">
                [1] "&lt;caption><span class=\"nowrap\">IFR estimate per age group&lt;br /&gt;(to December 2020)...
                </code></pre>
            </section>


            <section>
                <h2>HTML</h2>
                <ul>
                    <li>HTML: HyperText Markup Language
                    </li>
                    <li>HTML processing is an important and time consuming task
                    </li>
                    <li>Many high level processing tools have been developed for extracting data from HTML
                        <ul>
                            <li>HTML has specific formats and markups
                            </li>
                            <li>XML (Extensible Markup Language) also contains markups</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>HTML as Tree</h2>
                <pre><code data-trim data-noescape class="language-html">
                    &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;p&gt;paragraph1.&lt;/p&gt;
                        &lt;p&gt;paragraph 2.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
                </code></pre>
                <img src="img/html_tree.png" width="60%">
            </section>

            <section>
                <h2>HTML Parser</h2>
                <ul>
                    <li>Build the tree by applying REs on html
                    </li>
                    <li>Data are contained in nodes
                    </li>
                    <li>another high level “RE” to extract the nodes
                    </li>
                    <li>Example: XPath [http://www.w3schools.com/xpath/]
                    </li>
                    <li>Limitations: HTML standards are changing very fast. Parsers may generate errors</li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    install.packages("XML", repo = 'https://cloud.r-project.org')
                    library(XML)
                    tbl <- readHTMLTable(a)
                    tbl[3]        
                </code></pre>
                <p>Output</p>
                <pre><code data-trim data-noescape class="language-r">
                    $`IFR estimate per age group(to December 2020)[307]`
                            V1     V2
                    1 Age group    IFR
                    2    0â€“34 0.004%
                    3   35â€“44 0.068%
                    4   45â€“54  0.23%
                    5   55â€“64  0.75%
                    6   65â€“74   2.5%    
                </code></pre>
            </section>

            <section>
                <h2>Overview of Tools</h2>
                <img src="img/overview_r_html_tools.png" width="100%">
            </section>

            <section>
                <h2>References</h2>
                <ul>
                    <li>AoRP: ch 11</li>
                    <li>http://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html</li>
                    <li>http://www.w3schools.com/tags/ref_httpmethods.asp</li>
                </ul>
            </section>

        </div>
    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>