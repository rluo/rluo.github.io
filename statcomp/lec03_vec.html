<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec03 Vector/Matrix</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>




            <section>
                <h1>Vector</h1>



            </section>


            <section>
                <h2>Vector</h2>
                <ul>
                    <li>Fundamental type</li>
                    <li>Modes: integer, numeric, character, logical, complex and so on</li>
                    <li>Stored continuously in mem: cannot insert and delete</li>
                    <li>Review basic operations on vectors: <emphcode>length, i in vec, c</emphcode>
                    </li>
                    <li>
                        <emphcode>1:length(x)</emphcode> may return <emphcode>1, 0</emphcode>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Insert and Delete</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- c(1, 2, 3)
                    > x <- c(x[1:2], c( 4, x[3] ))
                    > x
                    [1] 1 2 4 3
                </code></pre>
                <br>
                <h3 style="text-align: left;">The following steps take place:</h3>
                <ol>
                    <li>allocate a mem chunk storing [1, 2, 3] and call the chunk by the name <emphcode>x</emphcode>
                        (like pointer
                        in C)</li>
                    <li>allocate a new and larger chunk copying and add elements</li>
                    <li>let the variable name point to the new chunk</li>
                </ol>
            </section>

            <section>
                <h2>Vector in Mem</h2>
                <pre><code data-trim data-noescape class="language-r">
                    x <- c(1, 2, 3)
                    y <- x
                    library(lobstr)
                    obj_addr(x)
                    #> [1] "0x7fe11b31b1e8"
                    obj_addr(y)
                    #> [1] "0x7fe11b31b1e8"
                </code></pre>
                <ul>
                    <li>
                        <emphcode>x</emphcode> and <emphcode>y</emphcode> point to the same chunk with address
                        <emphcode>0x7fe11b31b1e8</emphcode>
                    </li>
                    <li>One will get the same value by either name <emphcode>x</emphcode> and <emphcode>y</emphcode>
                    </li>
                </ul>
            </section>

            <section data-state="ar">
                <h2>Name as Pointer</h2>
                <img src="https://d33wubrfki0l68.cloudfront.net/bdc72c04d3135f19fb3ab13731129eb84c9170af/f0ab9/diagrams/name-value/binding-2.png"
                    width="80%" alt="">
                <p>However, the address may change if we modify the vector <emphcode>x</emphcode> or <emphcode>y
                    </emphcode>
                </p>
                <style>
                    .ar credit:after {
                        content: "https://adv-r.hadley.nz/index.html";
                    }
                </style>
            </section>

            <section>
                <h2>Copy on Modify</h2>
                <p>Mem chunks copied to new address only if two or more names point to different values after
                    modification</p>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- c(1,2, 3)
                    > y <- x
                    > obj_addr(y)
                    [1] "0x7f8711e2a288"
                    > obj_addr(x)
                    [1] "0x7f8711e2a288"
                    > x <- c(x, 4)
                </code></pre>
                <p>What are the addresses of <emphcode>x</emphcode> and <emphcode>y</emphcode>?
                </p>
                <pre class="fragment fade-up"><code data-trim data-noescape class="language-r">
                    > obj_addr(x)
                    [1] "0x7f8711e2b2c8"
                    > obj_addr(y)
                    [1] "0x7f8711e2a288"
                </code></pre>
            </section>

            <section>
                <h2>tracemem()</h2>
                <p>You can verify memory copied by the function <emphcode>tracemem</emphcode>
                </p>
                <pre><code data-trim data-noescape class="language-r">
                    x <- c(1, 2, 3)
                    cat(tracemem(x), "\n")
                    #> <0x7f80c0e0ffc8> 
                    y <- x
                    y[[3]] <- 4L
                    #> tracemem[0x7f80c0e0ffc8 -> 0x7f80c4427f40]: 
                    y[[3]] <- 5L
                    # no output: means no mem copy operations 
                </code></pre>
                <p>Why no output for the last line?</p>
            </section>


            <section>
                <h2>Excercise</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > obj_addr(x)
                    [1] "0x7f8711e2b2c8"
                    > x[1] = 10
                    > obj_addr(x)
                    [1] "0x7f8711e2b2c8"
                    > x[1] <- "10"
                    > obj_addr(x)
                    [1] "0x7f87020a1c70"
                </code></pre>
                <p>Explain why the address was or was not changed on each line.</p>

            </section>

            <section>
                <h2>Excercise</h2>
                <p>If <emphcode>x</emphcode> points to a mem chunk of 4G, what is the memory requirement for the
                    following operation?</p>
                <pre><code data-trim data-noescape class="language-r">
                    y <- c(x, x)
                    z <- x
                </code></pre>
                <p style="text-align: left;">Type number in webex chat:</p>
                <ol>
                    <li>&asymp; 4G</li>
                    <li>&asymp; 8G</li>
                    <li>&asymp; 12G</li>
                    <li>&asymp; 16G</li>
                </ol>
            </section>

            <section>
                <h2>Allocation</h2>
                <pre><code data-trim data-noescape class="language-r">
                    y <- vector(length=2)                    
                    y[1] <- 1
                    y[2] <- 2
                </code></pre>
                <p>What is wrong with the following?</p>
                <pre><code data-trim data-noescape class="language-r">
                    y <-  NULL                
                    y <- c(y, 1)
                    y <- c(y, 2)
                </code></pre>
            </section>

            <section>
                <h2>Recycling</h2>
                <ul>
                    <li>Automatically recycles or repeats the shorter vector to match the length of the longer one, when
                        operating on two vectors togethers (e.g. add)</li>
                    <li>Sometimes, no warning if perfect recycling</li>
                    <pre><code data-trim data-noescape class="language-r">
                    > c(1, 2) + c(1, 2, 3, 4, 5)
                    [1] 2 4 4 6 6
                    Warning message:
                    In c(1, 2) + c(1, 2, 3, 4, 5) :
                      longer object length is not a multiple of shorter object length
                    > c(1, 2, 1, 2, 1) + c(1, 2, 3, 4, 5)
                    [1] 2 4 4 6 6
                    > c(1, 2) + c(1, 2, 3, 4)
                    [1] 2 4 4 6
                </code></pre>
                </ul>
            </section>

            <section>
                <h2>seq</h2>
                <p>Instead of using <emphcode>1:length(x)</emphcode>, use <emphcode>seq(x)</emphcode> instead</p>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- NULL
                    > 1:length(x)
                    [1] 1 0
                    > seq(x)
                    integer(0)
                </code></pre>
            </section>

            <section>
                <h2>Other Commands</h2>
                <ul>
                    <li>
                        <emphcode>rep</emphcode>
                    </li>
                    <li>
                        <emphcode>all</emphcode>
                    </li>
                    <li>
                        <emphcode>any</emphcode>
                    </li>
                    <li>
                        <emphcode>:</emphcode>
                    </li>
                    <li>
                        <emphcode>[]</emphcode>
                    </li>
                    <li>
                        <emphcode>[-1]</emphcode>
                    </li>
                    <li>
                        <emphcode>cumsum</emphcode>
                    </li>
                </ul>
            </section>


            <section>
                <h2>Example 2.5.1</h2>
                <pre><code data-trim data-noescape class="language-r">
                findruns <- function(x,k) {
                    n <- length(x)
                    runs <- NULL
                    for (i in 1:(n-k+1)) {
                        if (all(x[i:(i+k-1)]==1)) runs <- c(runs,i) 
                    }
                    return(runs)
                }                     
                </code></pre>
                <p>What are the issues?</p>
            </section>

            <section>
                <h2>Example 2.5.1</h2>
                <pre><code data-trim data-noescape class="language-r">
                    findruns1 <- function(x,k) {
                        n <- length(x)
                        runs <- vector(length=n)  _label~runsalloc@
                        count <- 0
                        for (i in 1:(n-k+1)) {
                           if (all(x[i:(i+k-1)]==1)) {
                              count <- count + 1
                              runs[count] <- i _label~runsfill@
                           }
                        }
                        if (count > 0) {
                           runs <- runs[1:count] _label~runsredefine@
                        } else runs <- NULL
                        return(runs)
                     }                                    
                </code></pre>
                <p>This reduces the number of allocations.</p>
            </section>


            <section>
                <h2>Vectorization</h2>
                <ul>
                    <li>Most R functions operate on vectors</li>
                    <li>vector in and vector out: input and output of the same length</li>
                    <li>vector in and matrix out: function returns multiple elements for a scalar input or use
                        <emphcode>sapply</emphcode>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Reading</h2>
                <ul>
                    <li>NA vs NULL</li>
                    <li>Filtering</li>
                    <li>ifelse</li>
                    <li>Testing equality</li>
                    <li>Vector element names</li>
                </ul>
            </section>

            <section>
                <h1>Matrix</h1>
            </section>

            <section>
                <h2>Matrix</h2>
                <ul>
                    <li>Matrices are actually vectors, with extra class attributes</li>
                    <li>Stored as a vector, by concatenating the 1st, 2nd, .... columns (in this order) as a long vecotr
                    </li>
                    <li>Also known as column major order, default in Fortran and other linear algebra packages built on
                        Fortran that R calls</li>
                    <li>Also recycles the "shorter" matrix to match the "longer" matrix in operations</li>
                </ul>
            </section>




            <!-- OLD -->



            <section>
                <h2>References</h2>
                <ul>
                    <li>Linux commands at
                        <small
                            style="vertical-align: text-bottom;">https://ubuntu.com/tutorials/command-line-for-beginners#1-overview</small>
                    </li>
                    <li>Rstudio Git:
                        <ul>
                            <li>https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN
                            </li>
                            <li>https://cfss.uchicago.edu/setup/git-with-rstudio/</li>
                            <li>https://happygitwithr.com/rstudio-git-github.html</li>
                        </ul>
                    </li>
                    <li>Github: <small
                            style="vertical-align: text-bottom;">https://guides.github.com/activities/hello-world/</small>
                    </li>
                    <li>Docker: <small style="vertical-align: text-bottom;">https://docs.docker.com/get-started/</small>
                    </li>
                    <li>Git workflow: <small
                            style="vertical-align: text-bottom;">https://www.atlassian.com/git/tutorials/comparing-workflows</small>
                    </li>
                    <li>R Markdown: <small
                            style="vertical-align: text-bottom;">https://r4ds.had.co.nz/r-markdown.html</small></li>
                </ul>
                </p>
            </section>

        </div>

    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>