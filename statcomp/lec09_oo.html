<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec09 OO</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>

            <section>
                <h2>Objective Oriented Programming</h2>
                <ul>
                    <li>Popular design and may lead to clearer and more usable code
                    </li>
                    <li>R is not full OOP like JAVA, C++
                    </li>
                    <li>R enables OOP through S3 (dominant) or S4 (e.g. Bioconductor)
                    </li>
                    <li>Limited OOP but enough for most data tasks</li>
                </ul>
            </section>

            <section>
                <h2>R Theme</h2>
                <ul>
                    <li>Object: everything is object but not everything is OO</li>
                    <li>Base obj (e.g. vector) vs OO obj (e.g. lm)</li>
                    <li>Encapsulation: package similar objects together in class</li>
                    <li>Polymorphic: same function name calls on different implementations depending on the data class
                    </li>
                    <li>Inheritance: allows extending more general class to more specific ones</li>
                </ul>
            </section>

            <section>
                <h2>S3</h2>
                <ul>
                    <li>S3 for class structure</li>
                    <li>Essentially list with class name and function dispatch</li>
                    <li>Polymorphic: class name of <emphcode>x</emphcode> determines what function to call when running
                        <emphcode>f(x)</emphcode>
                    </li>
                    <li>Many functions written this way: e.g. <emphcode>plot, sum, summary</emphcode>
                    </li>
                    <li>Easy to remember, without worrying about exactly what data inside <emphcode>x</emphcode>
                    </li>
                    <li>Same interface for new packages and classes</li>
                    <li>Such functions called <emph>generic</emph> functions</li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- runif(100)
                    > y <- runif(100)
                    > lmout <- lm(y~x)
                    > class(lmout)
                    [1] "lm"
                    > lmout
                    
                    Call:
                    lm(formula = y ~ x)
                    
                    Coefficients:
                    (Intercept)            x  
                        0.54207     -0.09403  
                </code></pre>
            </section>


            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > print
                    function (x, ...) 
                    UseMethod("print")
                    &lt;bytecode: 0x7fc168f52f98&gt;
                    &lt;environment: namespace:base&gt;
                    > stats::print.lm
                    Error: 'print.lm' is not an exported object from 'namespace:stats'
                </code></pre>
                <p>
                    <emphcode>UseMethod</emphcode> is dispatch function, <emphcode>print</emphcode> is generic function
                </p>
                <pre><code data-trim data-noescape class="language-r">
                    s3_dispatch(print(lmout))
                    #> => print.factor
                    #>  * print.default
                </code></pre>
            </section>



            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > getAnywhere(print.lm)
                    A single object matching ‘print.lm’ was found
                    It was found in the following places
                    registered S3 method for print from namespace stats
                    namespace:stats
                    with value
                    function (x, digits = max(3L, getOption("digits") - 3L), ...)
                    {
                        ...
                        invisible(x)
                    }
                    &lt;bytecode: 0x7fc0bcce5510&gt;
                    &lt;environment: namespace:stats&gt;               
                    </code></pre>
                <p>Note function not in the default namespace</p>
            </section>

            <section>
                <h2>S3 Methods</h2>
                <ul>
                    <li>S3 methods with . to join words or classes</li>
                    <li>Usually not exported, not available outside pkg, not available in GlobalEnv</li>
                    <li>Alternative: <emphcode>sloop::s3_get_method</emphcode>
                    </li>
                    <li>Dispatch works by searching method names <emphcode>paste0("generic", ".", c(class(x),
                            "default"))</emphcode>
                    </li>
                </ul>
            </section>


            <section>
                <h2>Generic Function</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > methods(print)
                    [1] print,ANY-method                                    
                    [2] print,diagonalMatrix-method                         
                    [3] print,sparseMatrix-method                           
                    [4] print.aareg*                                        
                    ...
                    > methods(class="default")
                    [1] add1            aggregate       AIC             all.equal      
                    [5] ansari.test     anyDuplicated   aperm           ar.burg        
                    [9] ar.yw           as.array        as.character    as.data.frame  
                    [13] as.Date         as.dist         as.expression   as.function
                </code></pre>
            </section>


            <section>
                <h2>Writing S3</h2>
                <pre><code data-trim data-noescape class="language-r">
                    function (formula, data, subset, weights, na.action, method = "qr", 
                        model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, 
                        contrasts = NULL, offset, ...) 
                    {
                        ...
                        cl <- match.call()
                        ...
                            z <- list(coefficients = if (mlm) matrix(NA_real_, 0, 
                                    ...
                        ...
                                lm.fit(x, y, offset = offset, singular.ok = singular.ok, 
                                    ...)
                        class(z) <- c(if (mlm) "mlm", "lm")
                        z$na.action <- attr(mf, "na.action")
                        ...
                        z
                    }
                    &lt;bytecode: 0x7fc14e0df7d0&gt;
                    &lt;environment: namespace:stats&gt;
                </code></pre>
            </section>

            <section>
                <h2>Writing S3</h2>
                <ul>
                    <li>Create a list object</li>
                    <li>Set class attribute by <emphcode>attr</emphcode> or <emphcode>class</emphcode>
                    </li>
                    <li>Creat functions serving the object (e.g. <emphcode>print</emphcode>)</li>
                    <li>Try to avoid class names created by others</li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > j <- list(first="Joe", last="Doe")
                    > class(j) <- "mys3"
                    > attributes(j)
                    $names
                    [1] "first" "last" 
                    $class
                    [1] "mys3"
                    > j
                    $first
                    [1] "Joe"
                    $last
                    [1] "Doe"
                    attr(,"class")
                    [1] "mys3"
                </code></pre>
            </section>

            <section>
                <h2>Cutomize Print</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > print.mys3 <- function(obj) {
                    +    cat(obj$last, ", ", obj$first, " says hi!\n")
                    + }
                    > j
                    Doe ,  Joe  says hi!
                </code></pre>
            </section>

            <section>
                <h2>Inheritance</h2>
                <ul>
                    <li>class can have multiple class names</li>
                    <li>Specific/children (sub)class names first, general/parent class names last </li>
                    <li>R searches <emph>classname</emph> in func.<emph>classname</emph> in that order until found </li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > k <- list(first="Joe", last="Doe", salary=1e6)
                    > class(k) <- c("mys3child", "mys3")
                    > k
                    Doe ,  Joe  says hi!
                    > print.mys3child <- function(obj) {
                    +   cat(obj$last, ", ", obj$first, " earns ", obj$salary, " a year.\n")
                    + }
                    > k
                    Doe ,  Joe  earns  1e+06  a year.
                </code></pre>
            </section>

            <section>
                <h2>S4</h2>
                <ul>
                    <li>Created later for safety</li>
                    <li>Instead of manually setting class names and appending class names to functions, need to call
                        <emphcode>setClass</emphcode> and <emphcode>setMethod</emphcode>
                    </li>
                    <li>The key steps to create class is similar to S3</li>
                </ul>
            </section>

            <section>
                <h2>References</h2>
                <ul>
                    <li>AoRP: ch 9</li>
                </ul>
            </section>

        </div>
    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>