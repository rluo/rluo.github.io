<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme">



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec02 Dev Environment</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>



            <section>
                <h2>Today's Plan</h2>
                <ul>
                    <li>Docker</li>
                    <li>Unix/Linux</li>
                    <li>Git</li>
                    <li>R Markdown</li>
                </ul>
            </section>


            <section>
                <h1>What is Docker?</h1>
            </section>

            <section>
                <h2>Typical Programs</h2>
                <p>Source code</p>
                <pre><code data-trim data-noescape class="language-cpp">
                    #include &lt;iostream&gt;
                    int main() {
                        std::cout << "Hi!";
                        return 0;
                    }
                </code></pre>
                <div class="noborder inlinemiddle" style="display: inline-block;
                vertical-align: middle; text-align: right;">
                    <img src="img/downarrow.svg" alt="" width="25%">
                </div>
                <div class="noborder inlinemiddle" style="display: inline-block;
            vertical-align: middle; text-align: left;">
                    <p>Compiler/linker (e.g. gcc)</p>
                </div>
                <p>Machine code</p>
                <pre><code data-trim data-noescape class="language-c">
                    0110110010100100101010.....
                </code></pre>
                <p>Note: this program also calls other other pieces of code for <emphcode>iostream</emphcode> which you
                    have
                    no
                    control of</p>
                <p>If others decided to change their code or running on a differnet machine, different behaviors might
                    arise </p>
            </section>

            <section>
                <h2>Virtualization</h2>
                <ul>
                    <li>Machine virtualization
                        <ul>
                            <li>Software to simulate cpu, mem, net, etc</li>
                            <li>Same as other software, e.g. Word</li>
                            <li>Examples: VMware, VirtualBox, Parallel
                            </li>
                        </ul>
                    </li>
                    <li>"Env" virtualization: Docker, Singularity
                    </li>
                </ul>
            </section>

            <section>
                <h2>Docker vs VM </h2>
                <img src="img/vm_vs_docker_arch.png" width="100%" alt="">
            </section>

            <section data-state="docker">
                <h2>Docker Ecosystem</h2>
                <img src="img/docker_hub_arch.svg" width="100%" alt="">
                <style>
                    .docker credit:after {
                        content: "https://docs.docker.com/engine/images/architecture.svg";
                    }
                </style>
            </section>

            <section>
                <h2>Docker Usage</h2>
                <ul>
                    <li>Package software and library
                        <ul>
                            <li>reproducible, no dependency bugs</li>
                        </ul>
                    </li>
                    <li>Easy deployment
                        <ul>
                            <li>deploy multiple app instances
                            </li>
                        </ul>
                    </li>
                    <li>Hardware and system updates (no dep impact)
                    </li>
                    <li>Security (running within container)</li>
                    <li>Additional flexibility by singularity, used by TACC</li>
                </ul>
            </section>

            <section>
                <h2>Docker and R</h2>
                <p>Install: <a href="https://hub.docker.com/_/r-base">https://hub.docker.com/_/r-base</a> </p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker pull r-base
                </code></pre>
                <p>You may specify older version of R by adding tags</p>
                <p>Run interactive:</p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker run -ti --rm r-base
                </code></pre>
                <p>Run in batch mode:</p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker run -ti --rm -v "$PWD":/home/docker -w /home/docker \
                        -u docker r-base R CMD check .
                </code></pre>
            </section>


            <section>
                <h2>Interactive</h2>
                <pre><code data-trim data-noescape class="language-bash">
                    % docker run -ti --rm r-base

                    R version 4.1.1 (2021-08-10) -- "Kick Things"
                    Copyright (C) 2021 The R Foundation for Statistical Computing
                    Platform: x86_64-pc-linux-gnu (64-bit)
                    
                    ...
                    
                    Type 'demo()' for some demos, 'help()' for on-line help, or
                    'help.start()' for an HTML browser interface to help.
                    Type 'q()' to quit R.
                    
                    > sum(1:10)
                    [1] 55
                </code></pre>
                <p>Plotting may not work but you can save plots as files</p>
            </section>

            <section>
                <h2>Basic Concepts</h2>
                <ul>
                    <li>Image: collection of OS and apps (e.g. R)</li>
                    <li>Container: running (or stopped) instance of a image</li>
                    <li>Docker hub: storage of images created for different purposes and versions</li>
                </ul>
            </section>

            <section data-state="dockerdoc">
                <h2>Other Docker Commands</h2>
                <ul>
                    <li>Run: <emphcode>docker run/exec</emphcode>
                    </li>
                    <li>List local images: <emphcode>docker images</emphcode>
                    </li>
                    <li>Manage local image: <emphcode>docker image [command]</emphcode>
                    </li>
                    <li>Start/stop container <emphcode>start, attach, stop</emphcode>
                    </li>
                    <li>Import/export images: <emphcode>docker pull/push</emphcode>
                    </li>
                </ul>
                <style>
                    .dockerdoc credit:after {
                        content: "https://docs.docker.com/engine/reference/commandline/docker/";
                    }
                </style>
            </section>

            <section>
                <h1>Linux</h1>
            </section>


            <section>
                <h1>Unix/Linux</h1>
                <ul>
                    <li>UNIX was originally developed at Bell Laboratories</li>
                    <li>Linux is a clone of the operating system Unix, written from
                        scratch by Linus Torvalds with community efforts</li>
                    <li>Modern Linux distributions: Ubuntu, CentOS, Suse, Redhat, Mint, ...</li>
                </ul>
            </section>

            <section>
                <h2>Linux Features</h2>
                <ul>
                    <li>Multitasking</li>
                    <li>Multiuser</li>
                    <li>Portability</li>
                    <li>Modular Structure</li>
                    <li>Library of application software (usually free)</li>
                    <li>Work environment “of unusual simplicity, power, and elegance"</li>
                </ul>
            </section>




            <section>
                <h2>Linux Organization</h2>
                <ul>
                    <li>kernel: controls the hardware, turns part of the system on and
                        off at the programmer’s command, schedules tasks, and
                        manages storage;</li>
                    <li>shell: connects and interprets users’ commands, calls
                        programs from memory, and executes them;</li>
                    <li>tools and applications: offer additional functionality to the
                        operating system.</li>
                </ul>
            </section>



            <section>
                <h2>Essential Concepts</h2>
                <ul>
                    <li>Process: everything that “runs” under linux is a process,
                        e.g. commands, codes, spreadsheets, terminal windows, etc.</li>
                    <li>Hierarchical file system: directories (folders), data files,
                        applications. Files are not processes!</li>
                    <li>Shell: A shell is a process that accepts command lines and
                        feeds them to the linux kernel. Ex. Bash, Zsh</li>
                    <li>Standard input/output. All processes have a standard input
                        and a standard output.</li>
                </ul>
            </section>


            <section>
                <h2>Command</h2>
                <ul>
                    <li>Syntax: command [option] parameter</li>
                    <li>Command: <emphcode>ls, wc, man, rm, cd, ...</emphcode>
                    </li>
                    <li>Options telling Linux to perform a command in
                        a particular way, e.g. -f</li>
                    <li>Parameter: e.g. file names</li>
                    <li>Wildcards: <emphcode>?</emphcode> matches any single character, <emphcode>*</emphcode> matches
                        any number of <emphcode>?</emphcode>
                    </li>
                    <li>Review linux commands on Ubuntu web</li>
                </ul>
            </section>

            <section data-state="linuxfile">
                <h2>File System as Tree</h2>
                <img src="img/Standard-unix-filesystem-hierarchy.svg" width="100%" alt="">
                <style>
                    .linuxfile credit:after {
                        content: "https://en.wikipedia.org/wiki/Unix_filesystem#/media/File:Standard-unix-filesystem-hierarchy.svg";
                    }
                </style>
            </section>

            <section>
                <h2>Pipe</h2>
                <ul>
                    <li>
                        <emphcode>command < file</emphcode> feed file as input to command
                    </li>
                    <li>
                        <emphcode>command > file</emphcode> save command output to file (overwritten)
                    </li>
                    <li>
                        <emphcode>command >> file</emphcode> save command output to file amd append to file if it exists
                    </li>
                    <li>
                        <emphcode>command1 | command2</emphcode> use output of command1 as input to command2
                    </li>
                </ul>
            </section>

            <section>
                <h2>Linux using Docker</h2>
                <p>Run under terminal and output</p>
                <pre><code data-trim data-noescape class="language-bash">
                    % docker run -ti --rm r-base bash
                    root@5ba24a4f8aec:/# ls
                    bin   dev  home  lib64	mnt  proc  run	 srv  tmp  var
                    boot  etc  lib	 media	opt  root  sbin  sys  usr
                    root@5ba24a4f8aec:/# ls -l  lib/*  | wc -l 
                    127
                    root@5ba24a4f8aec:/# exit
                    exit
                </code></pre>
            </section>

            <section>
                <h1>Git</h1>
            </section>

            <section>
                <h2>Version Control</h2>
                <br>
                <img src="img/version_control.png" width="100%" alt="">
                <br>
                <p>Key idea: no need to store multiple copies of the file from different versions, only need to store
                    the differences between versions and the revision history.</p>
            </section>

            <section>
                <h2>Git Model</h2>
                <img src="img/git_model.png" width="75%" alt="">
            </section>

            <section>
                <h2>Git</h2>
                <ul>
                    <li>Created by Linus Torvalds in 2005</li>
                    <li>Github, Bitbucket provide servers to host code repo</li>
                    <Li>Each collaborator stores a full-fledged copy of the project</Li>
                    <li>Resolve differences before pushing updates to the server</li>
                </ul>
            </section>

            <section>
                <h2>Almost Auto-Merging</h2>
                <ul>
                    <li>Each collaborator can make edits concurrently
                    </li>
                    <li>At the end, Git will usually resolve the conflicts in edits and make a merged copy with all
                        edits</li>
                </ul>
            </section>

            <section>
                <h2>Git Workflow: Central</h2>
                <ul>
                    <li>Simplest for a couple of collaborators
                    </li>
                    <li>One evolving version only
                    </li>
                    <li>Suitable for small projects</li>
                </ul>
            </section>

            <section>
                <h1>Example Workflow</h1>
            </section>

            <section><img src="img/git_workflow1.png" width="100%" alt=""></section>
            <section><img src="img/git_workflow2.png" width="100%" alt=""></section>
            <section><img src="img/git_workflow3.png" width="100%" alt=""></section>
            <section><img src="img/git_workflow4.png" width="100%" alt=""></section>
            <section><img src="img/git_workflow5.png" width="100%" alt=""></section>

            <section>
                <h2>Git and R</h2>
                <ul>
                    <li>Git command line already installed on linux/mac</li>
                    <li>Graphic user interfaces of Git available</li>
                    <li>Rstudio has Git integration</li>
                </ul>
            </section>

            <section data-state="rgit">
                <img src="https://cfss.uchicago.edu/media/git_exec_hu8136a0637682e52e9a115480d698fffd_339088_1200x1200_fit_lanczos_2.png"
                    width="100%" alt="">
                <style>
                    .rgit credit:after {
                        content: "https://cfss.uchicago.edu/setup/git-with-rstudio/";
                    }
                </style>
            </section>


            <section>
                <h1>R Markdown</h1>
            </section>

            <section>
                <h2>Markdown and YAML</h2>
                <ul>
                    <li>Markdown: lightweight marked language started in 2004</li>
                    <li>MD can be translated into other formats, such as PDF, HTML, DOCX, by e.g. pandoc</li>
                    <li>YAML: human readable data in text started in 2001, vs json, xml</li>
                    <li>R Markdown includes ingredients of both, and adds a few mor features</li>
                </ul>
            </section>


            <section>
                <h2>R Markdown</h2>
                <p>YAML header</p>
                <pre><code data-trim data-noescape class="language-yaml">
                    ---
                    title: "Diamond sizes"
                    date: 2016-08-25
                    output: html_document
                    ---
                </code></pre>
                <p>R code chunk</p>
                <pre><code data-trim data-noescape class="language-r">
                    ```{r setup, include = FALSE}
                    library(ggplot2)
                    library(dplyr)
                    
                    smaller <- diamonds %>% 
                      filter(carat <= 2.5)
                    ```
                </code></pre>
            </section>

            <section>
                <h2>R Markdown II</h2>
                <p>Markdown and R</p>
                <pre><code data-trim data-noescape class="language-markdown">
                    We have data about `r nrow(diamonds)` diamonds. Only 
                    `r nrow(diamonds) - nrow(smaller)` are larger than
                    2.5 carats. The distribution of the remainder is shown
                    below:
                </code></pre>
            </section>

            <section>
                <h2>Two-step Process</h2>
                <ul>
                    <li>R markdown (.Rmd) converted to pure markdown (.md, inlcuding R computation and output as texts)
                        by R
                        packages like knitr.</li>
                    <li>Markdown (.md) then converted to any formats that it supports </li>
                </ul>
            </section>

            <section>
                <h2>How to Learn</h2>
                <ul>
                    <li>Learn markdown syntax</li>
                    <li>Learn YAML syntax</li>
                    <li>Learn inline code, chunk and options</li>
                    <li>(Optional) learn pretty-formatted table by <emphcode>kable</emphcode>
                    </li>
                    <li>Learn other advanced RMarkdown options (caching) for improved performance and customized
                        behavior</li>
                    <li>Other advanced use (e.g. interactive)</li>
                    <li>Reading: R for Data Science, ch 21, 23, 24</li>
                </ul>
            </section>

            <section>
                <h2>References</h2>
                <ul>
                    <li>Linux commands at
                        <small
                            style="vertical-align: text-bottom;">https://ubuntu.com/tutorials/command-line-for-beginners#1-overview</small>
                    </li>
                    <li>Rstudio Git:
                        <ul>
                            <li>https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN
                            </li>
                            <li>https://cfss.uchicago.edu/setup/git-with-rstudio/</li>
                            <li>https://happygitwithr.com/rstudio-git-github.html</li>
                        </ul>
                    </li>
                    <li>Github: <small
                            style="vertical-align: text-bottom;">https://guides.github.com/activities/hello-world/</small>
                    </li>
                    <li>Docker: <small style="vertical-align: text-bottom;">https://docs.docker.com/get-started/</small>
                    </li>
                    <li>Git workflow: <small
                            style="vertical-align: text-bottom;">https://www.atlassian.com/git/tutorials/comparing-workflows</small>
                    </li>
                    <li>R Markdown: <small
                            style="vertical-align: text-bottom;">https://r4ds.had.co.nz/r-markdown.html</small></li>
                </ul>
                </p>
            </section>

        </div>

    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>