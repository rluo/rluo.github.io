<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme">



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec02 Dev Environment</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>



            <section>
                <h2>Today's Plan</h2>
                <ul>
                    <li>Docker</li>
                    <li>Unix/Linux</li>
                    <li>Git</li>
                    <li>Markdown</li>
                </ul>
            </section>


            <section>
                <h1>What is Docker?</h1>
            </section>

            <section>
                <h2>Typical Programs</h2>
                <p>Source code</p>
                <pre><code data-trim data-noescape class="language-c">
                    #include <iostream>
                    int main() {
                        std::cout << "Hi!";
                        return 0;
                    }
                </code></pre>
                <div class="noborder inlinemiddle" style="display: inline-block;
                vertical-align: middle; text-align: right;">
                    <img src="img/downarrow.svg" alt="" width="25%">
                </div>
                <div class="noborder inlinemiddle" style="display: inline-block;
            vertical-align: middle; text-align: left;">
                    <p>Compiler/linker (e.g. gcc)</p>
                </div>
                <p>Machine code</p>
                <pre><code data-trim data-noescape class="language-c">
                    0110110010100100101010.....
                </code></pre>
                <p>Note: this program also calls other other pieces of code for <emphcode>iostream</emphcode> which you
                    have
                    no
                    control off</p>
                <p>If others decided to change their code or running on a differnet machine, different behaviors may
                    arise </p>
            </section>

            <section>
                <h2>Virtualization</h2>
                <ul>
                    <li>Machine virtualization
                        <ul>
                            <li>Software to simulate cpu, mem, net, etc</li>
                            <li>Same as other software, e.g. Word</li>
                            <li>Examples: VMware, VirtualBox, Parallel
                            </li>
                        </ul>
                    </li>
                    <li>"Env" virtualization: Docker, Singularity
                    </li>
                </ul>
            </section>

            <section>
                <h2>Docker vs VM </h2>
                <img src="img/vm_vs_docker_arch.png" width="100%" alt="">
            </section>

            <section data-state="docker">
                <h2>Docker Ecosystem</h2>
                <img src="img/docker_hub_arch.svg" width="100%" alt="">
                <style>
                    .docker credit:after {
                        content: "https://docs.docker.com/engine/images/architecture.svg";
                    }
                </style>
            </section>

            <section>
                <h2>Docker Usage</h2>
                <ul>
                    <li>Package software and library
                        <ul>
                            <li>reproducible, no dependency bugs</li>
                        </ul>
                    </li>
                    <li>Easy deployment
                        <ul>
                            <li>deploy multiple app instances
                            </li>
                        </ul>
                    </li>
                    <li>Hardware and system updates (no dep impact)
                    </li>
                    <li>Security (running within container)</li>
                    <li>Additional flexibility by singularity, used by TACC</li>
                </ul>
            </section>

            <section>
                <h2>Docker and R</h2>
                <p>Install: https://hub.docker.com/_/r-base</p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker pull r-base
                </code></pre>
                <p>You may specify older version of R by adding tags</p>
                <p>Run interactive:</p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker run -ti --rm r-base
                </code></pre>
                <p>Run in batch mode:</p>
                <pre><code data-trim data-noescape class="language-bash">
                    docker run -ti --rm -v "$PWD":/home/docker -w /home/docker \
                        -u docker r-base R CMD check .
                </code></pre>
            </section>


            <section>
                <h2>Interactive</h2>
                <pre><code data-trim data-noescape class="language-bash">
                    % docker run -ti --rm r-base

                    R version 4.1.1 (2021-08-10) -- "Kick Things"
                    Copyright (C) 2021 The R Foundation for Statistical Computing
                    Platform: x86_64-pc-linux-gnu (64-bit)
                    
                    ...
                    
                    Type 'demo()' for some demos, 'help()' for on-line help, or
                    'help.start()' for an HTML browser interface to help.
                    Type 'q()' to quit R.
                    
                    > sum(1:10)
                    [1] 55
                </code></pre>
                <p>Plotting may not work but you can save plots as files</p>
            </section>

            <section>
                <h2>Basic Concepts</h2>
                <ul>
                    <li>Image: collection of OS and apps (e.g. R)</li>
                    <li>Container: running (or stopped) instance of a image</li>
                    <li>Docker hub: storage of images created for different purposes and versions</li>
                </ul>
            </section>

            <section data-state="dockerdoc">
                <h2>Other Docker Commands</h2>
                <ul>
                    <li>Run: <emphcode>docker run/exec</emphcode>
                    </li>
                    <li>List local images: <emphcode>docker images</emphcode>
                    </li>
                    <li>Manage local image: <emphcode>docker image [command]</emphcode>
                    </li>
                    <li>Start/stop container <emphcode>start, attach, stop</emphcode>
                    </li>
                    <li>Import/export images: <emphcode>docker pull/push</emphcode>
                    </li>
                </ul>
                <style>
                    .dockerdoc credit:after {
                        content: "https://docs.docker.com/engine/reference/commandline/docker/";
                    }
                </style>
            </section>


            <section>
                <h1>Unix/Linux</h1>
            </section>

            <section>
                <h2>Linux</h2>

            </section>


            <section>
                <h2>Running Linux on Docker</h2>

                <pre><code data-trim data-noescape class="language-bash">
                    % docker run -ti --rm r-base bash
                    root@7f6528ede0b5:/# ls
                    bin   dev  home  lib64	mnt  proc  run	 srv  tmp  var
                    boot  etc  lib	 media	opt  root  sbin  sys  usr
                    root@7f6528ede0b5:/# cd root
                    root@7f6528ede0b5:~# vim.tiny test
                    root@7f6528ede0b5:~# exit
                    exit
                </code></pre>
            </section>

            <Section>
                <h2>Prerequisites</h2>
                <ul>
                    <li>R experience (1+ yr)</li>
                    <li>Grad-level theory (stat inference)</li>
                    <li>Applied stat (e.g. Bayesian, categorical)</li>
                    <li>Willing to learn a bit beyond R (e.g. C++)</li>
                    <li>Plus: other scripting languages (e.g. Python)</li>
                    <li>This is not an intro R course</li>
                </ul>
            </Section>

            <section>
                <iframe data-src="https://pollev-embeds.com/rossiluo765" frameborder="0" width="800px"
                    height="600px"></iframe>
                <p>Respond at <emph>PollEv.com/rossiluo765</emph>
                </p>
                <p>Or text <emph>ROSSILUO765</emph> to <emph>37607</emph> once to join, then <strong>A</strong>,
                    <strong>B</strong>...
                </p>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    f <- function() {
                        i <- 0
                        function() {
                            i <<- i + 1
                            i
                        }
                    }
                    g1 <- f(); g2 <- f(); g1(); g2(); g1(); g2()
                    </code></pre>
                <p>What is the last printout value? </p>
                <p>Respond at <emph>PollEv.com/rossiluo765</emph>
                </p>
            </section>

            <section>
                <h1>Quick Review</h1>
            </section>

            <section>
                <h2>Why R?</h2>
                <ul>
                    <li>Free and available everywhere</li>
                    <li>Stat community and packages</li>
                    <li>Ecosystem: RMarkdown, Shiny, Rstudio</li>
                    <li>Functional programming</li>
                    <li>High performance: C++, parallel</li>
                </ul>
            </section>

            <section>
                <h2>R limitations</h2>
                <ul>
                    <li>Most wild codes not fast or elegant</li>
                    <li>Scripts without good design</li>
                    <li>Inconsistent, pkgs</li>
                    <li>Not efficient by design</li>
                    <li>Evolving very fast</li>
                </ul>
            </section>


            <section>
                <h2>Function</h2>
                <pre><code data-trim data-noescape class="language-r">
                    oddcount <- function(x)  {
                       k <- 0  # assign 0 to k
                       for (n in x)  {
                          if (n %% 2 == 1) k <- k+1  # %% is the modulo operator
                       }
                       return(k)
                    }
                </code></pre>
                <p>FP: variable <emphcode>oddcount</emphcode> assigned to <emphcode>function() {}</emphcode>
                </p>
                <p>Not much differnt from assigning <emphcode>oddcount = c(3,4) </emphcode>
                </p>
                <p>One may omit <emphcode>return</emphcode> as R returns the last value</p>
            </section>


            <section>
                <h2>Variable scope</h2>
                <ul>
                    <li>
                        <emphcode>k</emphcode> and <emphcode>n</emphcode> are <emph>local</emph> variables, not visible
                        outside the
                        function or <emphcode>{}</emphcode>
                    </li>
                    <li>R uses <emph>Lexical Scoping</emph>
                        <ul>
                            <li>values searched where variables defined and then upwards</li>
                        </ul>
                    </li>
                    <li>Variable arguments are copied when calling func</li>
                    <li>Variables defined outside func are <emph>global</emph>
                    </li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    f <- function() {
                        i <- 0
                        function() {
                            i <<- i + 1
                            i
                        }
                    }                     
                </code></pre>
                <ul>
                    <li>
                        <emphcode>i</emphcode> is local
                    </li>
                    <li>
                        <emphcode>f</emphcode> returns a function
                    </li>
                    <li>
                        This function accesses/modifies <emphcode>i</emphcode> defined in <emphcode>f</emphcode>
                    </li>
                </ul>
            </section>


            <section>
                <pre><code data-trim data-noescape class="language-r">
                    > i <- 100
                    > g <- f()
                    > g()
                    [1] 1                
                    > g()
                    [1] 2
                    > g2 <- f()
                    > g2()
                    [1] 1
                </code></pre>
                <p>How many variables are named <emphcode>i</emphcode>?
                </p>

            </section>


            <section>
                <h2>Vector</h2>
                <p>vectors are collections of elements of the same <emphcode>mode</emphcode>
                </p>
                <pre><code data-trim data-noescape class="language-r">
                    > x <- c(20,21,22)
                    > length(x)
                    [1] 3
                    > mode(x)
                    [1] "numeric"
                </code></pre>
            </section>

            <section>
                <h2>String</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > u <- paste("uth", "bads")
                    > mode(u)
                    [1] "character"
                    > u
                    [1] "uth bads"
                    > strsplit(u, " ")
                    [[1]]
                    [1] "uth"  "bads"
                </code></pre>
                <p>More on string manipulations later</p>
            </section>

            <section>
                <h2>Matrix</h2>
                <pre><code data-trim data-noescape class="language-r">
                    > m <- matrix(1:4, 2)
                    > m
                         [,1] [,2]
                    [1,]    1    3
                    [2,]    2    4
                    > m %*% c(1, 1)
                         [,1]
                    [1,]    4
                    [2,]    6
                </code></pre>
                <p>Note matrix multiply <emphcode>%*%</emphcode>
                </p>
                <p>Review: <emphcode>rbind/cbind</emphcode>, <emphcode>m[1,]</emphcode>, <emphcode>m[,2]
                    </emphcode>
                </p>
            </section>


            <section>
                <pre><code data-trim data-noescape class="language-r">
                    > cbind( matrix(1:2, 2), matrix(c("a", "b"), 2) )
                        [,1] [,2]
                    [1,] "1"  "a" 
                    [2,] "2"  "b" 
                </code></pre>
                <p>Like vector, matrix contains elements of the same type</p>
            </section>

            <section>
                <h2>List</h2>
                <p>Like vector, but can contain different types and even nested</p>

                <pre><code data-trim data-noescape class="language-r">
                    > l <- list(a=list(a1=list(10)), b="uth")
                    > l
                    $a
                    $a$a1
                    $a$a1[[1]]
                    [1] 10
                    
                    $b
                    [1] "uth"
                    > l$a$a1
                    [[1]]
                    [1] 10
                </code></pre>

            </section>

            <section>
                <h2>Data Frame</h2>
                <ul>
                    <li>Probably the most important data type</li>
                    <li>They are actually <emphcode>list</emphcode>
                    </li>
                    <li>Will discuss manipulation and performance issues</li>
                </ul>
            </section>

            <section>
                <h2>Class</h2>
                <p>R is also <emph>Object Oriented</emph>, or S3 system
                </p>
                <pre><code data-trim data-noescape class="language-r">
                    > print(hist(c(1:10)))
                    $breaks
                    [1]  0  2  4  6  8 10
                    
                    $counts
                    [1] 2 2 2 2 2
                    
                    $equidist
                    [1] TRUE
                    
                    attr(,"class")
                    [1] "histogram"
                </code></pre>
                <p>Attributes help decide which func within object to call</p>
                <pre><code data-trim data-noescape class="language-r">
                    > re <- summary( lm(c(1:20) ~ c(21:40)) )
                    > re <- summary.lm( lm(c(1:20) ~ c(21:40)) )
                </code></pre>
                <p>Newer S4 system will be skipped</p>
            </section>

            <section>
                <h2>Reference</h2>
                <ul>
                    <li>AoRP: ch 1</li>
                    <li>AR: ch 1</li>
                    <li>Check out the help tips!</li>
                </ul>
                <br>
                <br>
                <p>Save to pdf: append <emph>?print-pdf</emph> to the URL and then press <emph>CTRL/CMD + P</emph>
                </p>
            </section>

        </div>

    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>