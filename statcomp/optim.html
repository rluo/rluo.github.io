<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <!-- <style>
                .rds_db credit:after {
                    content: "https://r4ds.had.co.nz/relational-data.html";
                }
            </style> -->
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Optimization</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>


            <section>
                <pre><code data-trim data-noescape class="language-r">
                    soft_thresholding &lt;- function(x,a){
                        ## This could be done more efficiently using vector multiplication
                        ## See the forumula in slides
                        ##  sign(x)*pmax(abs(x) - a, 0)
                        result &lt;- numeric(length(x))
                        result[which(x > a)] &lt;- x[which(x > a)] - a
                        result[which(x &lt; -a)] &lt;- x[which(x < -a)] + a
                        return(result)
                    }                    
                </code></pre>
            </section>


            <section>
                <pre><code data-trim data-noescape class="language-r">
                    lasso_kkt_check &lt;- function(X,y,beta,lambda, tol=1e-3){
                        ## check convergence 
                        beta &lt;- as.matrix(beta); X &lt;- as.matrix(X)
                        ## Assuming no intercepts 
                        G &lt;- t(X)%*%(y-X%*%beta)/length(y)
                        ix &lt;- which(beta == 0 )
                        iy &lt;- which(beta != 0)
                        if (any(abs(G[ix]) > (lambda + tol) )) { return(pass=0) }
                        if (any(abs( G[iy] - lambda*sign(beta[iy] ) ) > tol)) { return(pass=0) }  
                        return(pass=1)
                    }                                      
                </code></pre>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    lasso.cd &lt;- function(X,y,beta,lambda,tol=1e-6,maxiter=1000,quiet=FALSE){
                        # note that the LS part  in this function is the one in slides divided by length(y) = n 
                        ## Or equivalently  lambda here = n * lambda in class
                        beta &lt;- as.matrix(beta); X &lt;- as.matrix(X)
                        obj &lt;- numeric(length=(maxiter+1))
                        betalist &lt;- list(length=(maxiter+1))
                        betalist[[1]] &lt;- beta
                        for (j in 1:maxiter){
                            for (k in 1:length(beta)){
                                r &lt;- y - X[,-k]%*%beta[-k]
                                beta[k] &lt;- (1/norm(as.matrix(X[,k]),"F")^2)*soft_thresholding(t(r)%*%X[,k],length(y)*lambda)
                            }
                            betalist[[(j+1)]] &lt;- beta
                            obj[j] &lt;- (1/2)*(1/length(y))*norm(y - X%*%beta,"F")^2 + lambda*sum(abs(beta))
                            if (norm(betalist[[j]] - beta,"F") &lt; tol) { break }
                        } 
                        check &lt;- lasso_kkt_check(X,y,beta,lambda) 
                        if (quiet==FALSE){
                            if (check==1) {
                                cat(noquote("Minimum obtained.\n"))
                            }
                          else { cat(noquote("Minimum not obtained.\n")) } 
                        }
                        return(list(obj=obj[1:j],beta=beta)) 
                    }                                   
                </code></pre>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    set.seed(100)
                    n <- 50
                    p <- 400
                    X <- matrix(rnorm(n*p), n, p)
                    b <- rep(0, 400)
                    b[301:305] <- c(5:1)*2
                    y <-  X%*%b + rnorm(n)
                    ynew <-  X%*%b + rnorm(n)                               
                </code></pre>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    &gt; system.time( re &lt;- lasso.cd(X, y, rep(0, 400), 1) ) 
                    Minimum obtained.
                       user  system elapsed 
                      1.812   0.673   2.492 
                    &gt; 
                    &gt; system.time( re &lt;- lasso.cd(X, y, re$beta, 0.9) ) 
                    Minimum obtained.
                       user  system elapsed 
                      1.310   0.496   1.805      
                    &gt; library(glmnet) 
                    &gt; system.time( fit &lt;- glmnet(X, y, intercept=F, standardize=F, lambda=1) ) 
                      user  system elapsed 
                     0.014   0.001   0.016                     
                </code></pre>
            </section>


            <!-- <section>
                <h2>References</h2>
                <ul>
                    <li>R for DS: ch 5 - 16</li>
                    <li>https://r4ds.had.co.nz/</li>
                    <li>https://exts.ggplot2.tidyverse.org/gallery/</li>
                    <li>https://www.rstudio.com/resources/cheatsheets/</li>
                </ul>
            </section> -->

        </div>
    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>