<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Lec12 File</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>


            <section>
                <h2>Why Files?</h2>
                <ul>
                    <li>File: the fundamental storage format
                        <ul>
                            <li>Web pages and stock quotes are stored in files (indirectly)
                            </li>
                        </ul>
                    </li>
                    <li>File system will continue to exist
                    </li>
                    <li>File storage is robust and flexible
                        <ul>
                            <li>May not be efficient for certain types of data</li>
                            <li>Compare with SQL (later)</li>
                        </ul>
                    </li>
                </ul>
            </section>


            <section>
                <h2>Two Paradigms</h2>
                <img src="img/file_paradigms.png" width="800px" alt="">
            </section>

            <section>
                <h2>Comparison</h2>
                <ul>
                    <li>One big file: “easy” to maintain and transfer
                    </li>
                    <li>Many small files
                        <ul>
                            <li>Scalable (blocks in clouds)
                            </li>
                            <li>Different types of data (images, videos and etc)
                            </li>
                            <li>Faster small updates
                            </li>
                            <li>Redundancy</li>
                        </ul>

                    </li>
                </ul>
            </section>

            <section>
                <h2>Strategies for Files</h2>
                <ul>
                    <li>One big file: “slice” it up
                    </li>
                    <li>Many small files: “catalog” them
                    </li>
                    <li>Extract <emph>only</emph> portions that R can handle</li>
                </ul>
            </section>


            <section>
                <h1>One Big File</h1>
            </section>


            <section>
                <h2>Example: PUMS5</h2>
                <ul>
                    <li>Compressed file: 1G
                    </li>
                    <li>Uncompressed files: 4x1G, each about 25% of the data
                    </li>
                    <li>Need to concatenate the 4 files
                    </li>
                    <li>It may not be loaded into R
                    </li>
                    <li>Goal: find the distribution of #Bathrooms</li>
                </ul>
            </section>

            <section>
                <h2>Unix Text Tools</h2>
                <ul>
                    <li>cat: output all the lines
                    </li>
                    <li>head: output first few lines
                    </li>
                    <li>tail: output last few lines
                    </li>
                    <li>grep: search all the lines by RE
                    </li>
                    <li>sed: powerful line processing tool including RE operations
                    </li>
                    <li>cut: extract part of a line</li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
            </section>

            <section>
                <h2>Strategy Summary</h2>
                <ul>
                    <li>Slicing easier in Bash</li>
                    <li>Horizontal slicing: read only wanted lines</li>
                    <li>Vertical slicing:
                        <ul>
                            <li>For each line, extract the wanted columns</li>
                            <li>Stack the extracted columns together</li>
                        </ul>

                    </li>
                </ul>
            </section>


            <section>
                <h1>Many Files</h1>
            </section>

            <section>
                <h2>PUM3 Downloads</h2>
                <ul>
                    <li>104 files for 52 states</li>
                    <li>All files are zipped</li>
                    <li>File names difficult to read</li>
                    <li>Goal: list of well named files</li>
                </ul>
            </section>

            <section>
                <h2>BASH Variables</h2>
                <ul>
                    <li>Assignment:
                        <ul>
                            <li>foo=“a”; foo is a BASH variable with value “a”
                            </li>
                        </ul>
                    </li>
                    <li>Get value:
                        <ul>
                            <li>Extract the value of foo by ${foo}</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>BASH Control</h2>
                <ul>
                    <li>echo: print the variable
                    </li>
                    <li>if-else like in R
                        <pre><code data-trim data-noescape class="language-bash">
                            if [ "$a" -ne 0 ]; then
                                echo "Hello"
                            else
                                echo ":("
                            fi
                        </code></pre>
                    </li>
                    <li>For loops
                        <pre><code data-trim data-noescape class="language-bash">
                            for x in rnage; do
                                ...
                            done
                        </code></pre>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    a &lt;- scan("http://www2.census.gov/acs2013_3yr/pums/", "character")
                    ## remove junks
                    a &lt;- a[grep("csv", a)]                  
                    ## extract the file names
                    a &lt;-  substring(a, 7, 17)                    
                    ## get the links to the zip files
                    baseurl &lt;- "http://www2.census.gov/acs2013_3yr/pums/"
                    aurl &lt;- paste(baseurl, a,sep="")                    
                    ## Download the files automatically
                    for (i in seq_along(a)) {
                        print(paste0("Downloading ", a[i]))
                        download.file(aurl[i], a[i])
                        ## To avoid overwhelming the web traffic,
                        ## Add pauses between downloads to mimic human clicking 
                        Sys.sleep(10)
                    }
                </code></pre>
            </section>


            <section>
                <h2>References</h2>
                <ul>
                    <li>AoRP: ch 11</li>
                    <li>R for DS: ch 14</li>
                    <li>http://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html</li>
                    <li>http://www.w3schools.com/tags/ref_httpmethods.asp</li>
                </ul>
            </section>

        </div>
    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>