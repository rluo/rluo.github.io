<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Statistical Computing</title>

    <meta name="author" content="Xi (Rossi) LUO">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reset.css">
    <link rel="stylesheet" href="reveal.js.4.1.3/dist/reveal.css">
    <!-- <link rel="stylesheet" href="reveal.js.4.1.3/dist/theme/white.css" id="theme"> -->



    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js.4.1.3/plugin/highlight/github-dark-dimmed.min.css">
    <!--
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
-->
    <link rel="stylesheet" href="./css/rossisimple.css" id="theme">
    <!--    <link rel="stylesheet" href="./css/brightRoom.css" id="theme">-->
</head>

<body>

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">

            <!--      place holder for credits: empty for now -->
            <credit></credit>
            <!-- <style>
                .rds_db credit:after {
                    content: "https://r4ds.had.co.nz/relational-data.html";
                }
            </style> -->
            <section>
                <h1><strong>
                        <highlight>Statistical</highlight>
                        <emph>Computing</emph>
                    </strong></h1>
                <br>
                <h2>Wrangle</h2>
                <br>

                <h3>Xi (Rossi) <strong>LUO</strong></h3>
                <br>
                <p><small>Department of Biostatistics and Data Science<br>
                        School of Public Health<br>The University of Texas Health Science Center at Houston</small></p>
            </section>


            <section>
                <h2>Data Wrangling</h2>
                <img src="https://d33wubrfki0l68.cloudfront.net/e3f9e555d0035731c04642ceb58a03fb84b98a7d/4f070/diagrams/data-science-wrangle.png"
                    alt="" width="65%">
            </section>


            <section>
                <h2>tibble</h2>
                <ul>
                    <li>Modern variant of R data.frame</li>
                    <li>tidy data: consistent way for transformation, visualization, and modeling </li>
                </ul>
            </section>




            <section>
                <h2>First Example</h2>
                <pre><code data-trim data-noescape class="language-r">
                    library(nycflights13)
                    library(tidyverse)
                    flights
                    #&gt; # A tibble: 336,776 x 19
                    #&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
                    #&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
                    #&gt; 1  2013     1     1      517            515         2      830            819
                    ...
                    #&gt; # … with 336,770 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
                    #&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
                    #&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
                 </code></pre>
            </section>

            <section>
                <h2>Basics</h2>
                <ul>
                    <li>
                        <emphcode>filter</emphcode>: pick rows
                    </li>
                    <li>
                        <emphcode>arrange</emphcode>: reorder rows
                    </li>
                    <li>
                        <emphcode>select</emphcode>: pick cols/vars
                    </li>
                    <li>
                        <emphcode>mutate</emphcode>: add new columns (derived vars)
                    </li>
                    <li>
                        <emphcode>summarize</emphcode>: reduce many values to scalar
                    </li>
                </ul>
            </section>

            <section>
                <h2>Workflow</h2>
                <ul>
                    <li>Start wtih data</li>
                    <li>Each layer with basic functions produces a new data frame</li>
                    <li>Multiple layers added together as pipeline</li>
                    <li>Similar to ggplot2</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    (dec25 &lt;- filter(flights, month == 12, day == 25))
                    #> # A tibble: 719 x 19
                    #>    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
                    #>   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
                    #&gt; 1  2013    12    25      456            500        -4      649            651
                    ...
                    #&gt; # … with 713 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
                    #&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
                    #&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
                 </code></pre>
            </section>

            <section>
                <h2>Logical Operators</h2>
                <ul>
                    <li>
                        <emphcode>&</emphcode>: and
                    </li>
                    <li>
                        <emphcode>|</emphcode>: or
                    </li>
                    <li>
                        <emphcode>!</emphcode>: not
                    </li>
                    <li>Not <emphcode>&&, ||</emphcode>, wich produces scalars
                    </li>
                </ul>
            </section>

            <section>
                <h2>Missing Values</h2>
                <ul>
                    <li>
                        <emphcode>NA</emphcode>: missing values
                    </li>
                    <li>
                        <emphcode>filter</emphcode>: excludes both FALSE and NA values
                    </li>
                </ul>
                <pre><code data-trim data-noescape class="language-r">
                    NA == NA
                    #&gt; [1] NA
                    filter(df, is.na(x) | x &gt; 1)
                    #&gt; # A tibble: 2 x 1
                    #&gt;       x
                    #&gt;   &lt;dbl&gt;
                    #&gt; 1    NA
                    #&gt; 2     3
                 </code></pre>
            </section>

            <section>
                <h2>arrange</h2>
                <ul>
                    <li>Default is ascending order</li>
                    <li>Missing values at the end</li>
                    <li>Ordered by variable ordered passed in</li>
                </ul>
                <pre><code data-trim data-noescape class="language-r">
                    arrange(flights, year, month, day)
                    #&gt; # A tibble: 336,776 x 19
                    ...
                    arrange(flights, desc(dep_delay))
                    #&gt; # A tibble: 336,776 x 19
                </code></pre>
            </section>


            <section>
                <h2>select</h2>
                <ul>
                    <li>Pick columns/variables</li>
                    <li>Powerful when name patterns are passed</li>
                    <li>Built-in name pattern functions</li>
                </ul>
                <pre><code data-trim data-noescape class="language-r">
                    # Select columns by name
                    select(flights, year, month, day)
                    # Select all columns between year and day (inclusive)
                    select(flights, year:day)
                    # Select all columns except those from year to day (inclusive)
                    select(flights, -(year:day))
                </code></pre>
            </section>

            <section>
                <h2>Helper Functions</h2>
                <ul>
                    <li>
                        <emphcode>starts_with('abc')</emphcode>: match var names begin with 'abc'
                    </li>
                    <li>
                        <emphcode>ends_with('abc')</emphcode>: end with 'abc'
                    </li>
                    <li>
                        <emphcode>contains('abc')</emphcode>: contain 'abc'
                    </li>
                    <li>
                        <emphcode>matches('(.)\\1')</emphcode>: match regular expression
                    </li>
                    <li>
                        <emphcode>num_range("x", 1:3)</emphcode>: x1, x2, and x3
                    </li>
                </ul>
            </section>

            <section>
                <h2>rename</h2>
                <p>rename changes variable names</p>
                <pre><code data-trim data-noescape class="language-r">
                    rename(flights, tail_num = tailnum)
                </code></pre>
            </section>

            <section>
                <h2>everything</h2>
                <p>everything() refers to all (other) variable names</p>
                <pre><code data-trim data-noescape class="language-r">
                    select(flights, time_hour, air_time, everything())
                </code></pre>
                <p>Moves two variables to the first two columns</p>
            </section>

            <section>
                <h2>mutate</h2>
                <ul>
                    <li>Transformed variables added to the end of tibble</li>
                    <li>Vector-type operations</li>
                    <li>Refer variable names without quotes</li>
                    <li>You can refer to columns that just created</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                flights_sml &lt;- select(flights, 
                    year:day, 
                    ends_with("delay"), 
                    distance, 
                    air_time
                )
                mutate(flights_sml,
                    gain = dep_delay - arr_delay,
                    speed = distance / air_time * 60
                )
                mutate(flights_sml,
                    gain = dep_delay - arr_delay,
                    hours = air_time / 60,
                    gain_per_hour = gain / hours
                )
                </code></pre>
            </section>

            <section>
                <h2>transmute</h2>
                <p>Unlike mutate, transmute only keeps the transformed variables</p>
                <pre><code data-trim data-noescape class="language-r">
                transmute(flights,
                    gain = dep_delay - arr_delay,
                    hours = air_time / 60,
                    gain_per_hour = gain / hours
                  )
                  #&gt; # A tibble: 336,776 x 3
                  #&gt;    gain hours gain_per_hour
                </code></pre>
            </section>

            <section>
                <h2>Operators in mutate/transmute</h2>
                <ul>
                    <li>Most operators should work</li>
                    <li>Operations are vectorized</li>
                    <li>Some specical ones</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    y &lt;- c(1, 2, 2, NA, 3, 4)
                    min_rank(y)
                    #&gt; [1]  1  2  2 NA  4  5
                    min_rank(desc(y))
                    #&gt; [1]  5  3  3 NA  2  1
                    row_number(y)
                    #&gt; [1]  1  2  3 NA  4  5
                    dense_rank(y)
                    #&gt; [1]  1  2  2 NA  3  4
                    percent_rank(y)
                    #&gt; [1] 0.00 0.25 0.25   NA 0.75 1.00
                    cume_dist(y)
                    #&gt; [1] 0.2 0.6 0.6  NA 0.8 1.0
                </code></pre>
            </section>

            <section>
                <h2>summarise</h2>
                <ul>
                    <li>mutate produces same number of rows</li>
                    <li>summarise reduces to a single row</li>
                    <li>Usually combined with <emphcode>group_by</emphcode>, to produce summaries for each group
                        <ul>
                            <li>ungroup removes grouping</li>
                        </ul>
                    </li>
                    <li>Only keeps the summarized variables, like transmute</li>
                    <li>Most summary functions work and more (check text book)</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    by_day &lt;- group_by(flights, year, month, day)
                    summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
                    #&gt; `summarise()` regrouping output by 'year', 'month' (override with `.groups` argument)
                    #&gt; # A tibble: 365 x 4
                    #&gt; # Groups:   year, month [12]
                    #&gt;    year month   day delay
                </code></pre>
            </section>


            <section>
                <h2>Pipe %&gt;%</h2>
                <pre><code data-trim data-noescape class="language-r">
                    delays &lt;- flights %&gt;% 
                    group_by(dest) %&gt;% 
                    summarise(
                      count = n(),
                      dist = mean(distance, na.rm = TRUE),
                      delay = mean(arr_delay, na.rm = TRUE),
                      n = n()
                    ) %&gt;% 
                    filter(count &gt; 20, dest != "HNL")
                    #&gt; `summarise()` ungrouping output (override with `.groups` argument)
                    ggplot(data = delays, mapping = aes(x = dist, y = delay)) +
                    geom_point(aes(size = count), alpha = 1/3) +
                    geom_smooth(se = FALSE)
                </code></pre>
                <p>Imperative layers added to achieve transformations and plotting</p>
                <p>Count by <emphcode>n()</emphcode>
                </p>
            </section>

            <section>
                <img src="https://d33wubrfki0l68.cloudfront.net/29c6c007a9dd15c20a77736d60bc27e8aaa690c0/a40a3/transform_files/figure-html/unnamed-chunk-35-1.png"
                    alt="" width="80%">
            </section>

            <section>
                <h2>Pipe dplyr and ggplot2</h2>
                <pre><code data-trim data-noescape class="language-r">
                    delays %>% 
                    filter(n > 25) %>% 
                    ggplot(mapping = aes(x = n, y = delay)) + 
                      geom_point(alpha = 1/10)
                </code></pre>
                <img src="https://d33wubrfki0l68.cloudfront.net/4d2332588c630118dc9827bc67506a8db02a75b0/50a17/transform_files/figure-html/unnamed-chunk-42-1.png"
                    alt="" width="60%">
            </section>


            <section>
                <h2>tibble</h2>
                <ul>
                    <li>Much like data.frame but does less</li>
                    <li>Never converts strings to factors</li>
                    <li>Never changes var names</li>
                    <li>never creates row names</li>
                    <li>
                        <emphcode>as_tibble, tibble</emphcode>
                    </li>
                    <li>Pretty much like data.frame and other packages, if not, convert back to data.frame</li>
                </ul>
            </section>


            <section>
                <h2>tribble</h2>
                <pre><code data-trim data-noescape class="language-r">
                    tribble(
                        ~x, ~y, ~z,
                        #--|--|----
                        "a", 2, 3.6,
                        "b", 1, 8.5
                      )
                      #&gt; # A tibble: 2 x 3
                      #&gt;   x         y     z
                      #&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
                      #&gt; 1 a         2   3.6
                      #&gt; 2 b         1   8.5
                </code></pre>
                <p>More readble format (by-rows) for creating tibble</p>
            </section>

            <section>
                <h2>From File: readr</h2>
                <ul>
                    <li>readr::read_csv for import csv files</li>
                    <li>Typically ~10x faster than basic R read.csv</li>
                    <li>Even faster: data.table::fread()</li>
                    <li>Platform independent</li>
                    <li>read_csv arguments like read.csv with some changes</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                read_csv("The first line of metadata
                    The second line of metadata
                    x,y,z
                    1,2,3", skip = 2)                 
                read_csv("# A comment I want to skip
                    x,y,z
                    1,2,3", comment = "#")
                read_csv("1,2,3\n4,5,6", col_names = FALSE)
                read_csv("1,2,3\n4,5,6", col_names = c("x", "y", "z"))
                read_csv("a,b,c\n1,2,.", na = ".")
                </code></pre>
            </section>

            <section>
                <h2>parse_* Function</h2>
                <ul>
                    <li>
                        <emphcode>parse_logical</emphcode>
                    </li>
                    <li>
                        <emphcode>parse_integer</emphcode>
                    </li>
                    <li>
                        <emphcode>parse_double</emphcode>
                    </li>
                    <li>
                        <emphcode>parse_character</emphcode>
                    </li>
                    <li>
                        <emphcode>parse_factor</emphcode>
                    </li>
                    <li>
                        <emphcode>parse_datetime, parse_date, parse_time</emphcode>
                    </li>
                    <li>
                        <emphcode>guess_encoding, guess_parser</emphcode>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Reading File</h2>
                <ul>
                    <li>Usually type parsed correctly</li>
                    <li>May override by specifying types manually</li>
                </ul>
            </section>

            <section>
                <pre><code data-trim data-noescape class="language-r">
                    challenge &lt;- read_csv(
                        readr_example("challenge.csv"), 
                        col_types = cols(
                          x = col_double(),
                          y = col_date()
                        )
                      )
                      tail(challenge)
                      #&gt; # A tibble: 6 x 2
                      #&gt;       x y         
                      #&gt;   &lt;dbl&gt; &lt;date&gt;    
                      #&gt; 1 0.805 2019-11-21
                      #&gt; 2 0.164 2018-03-29
                      #&gt; 3 0.472 2014-08-04
                      #&gt; 4 0.718 2015-08-16
                      #&gt; 5 0.270 2020-02-04
                      #&gt; 6 0.608 2019-01-06
                </code></pre>
            </section>


            <section>
                <pre><code data-trim data-noescape class="language-r">
                    challenge2 &lt;- read_csv(readr_example("challenge.csv"), guess_max = 1001)
                    #&gt; 
                    #&gt; ── Column specification ────────────────────────────────────────────────────────
                    #&gt; cols(
                    #&gt;   x = col_double(),
                    #&gt;   y = col_date(format = "")
                    #&gt; )
                    
                    # Or read in all rows as characters
                    challenge2 <- read_csv(readr_example("challenge.csv"), 
                        col_types = cols(.default = col_character())
                    )
                    type_convert(challenge2)
                </code></pre>
            </section>

            <section>
                <h2>Writing Files</h2>
                <ul>
                    <li>
                        <emphcode>write_csv,write_tsv</emphcode> for writing tibble to text files
                    </li>
                    <li>
                        <emphcode>write_excel_csv</emphcode> for excel files
                    </li>
                    <li>
                        <emphcode>write_rds/read_rds</emphcode> for writing/reading R's custom binary format
                    </li>
                    <li>
                        <emphcode>write_feather/read_feather</emphcode> for writing/reading fast binary format by
                        <emphcode>library(feather)</emphcode>
                        <ul>
                            <li>List columns not supported</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section>
                <h2>Other Non-Text Data</h2>
                <ul>
                    <li>
                        <emphcode>haven</emphcode> for SPSS, Stata, SAS
                    </li>
                    <li>
                        <emphcode>readxl</emphcode> for Excel
                    </li>
                    <li>
                        <emphcode>DBI</emphcode> for RDBMs and SQL
                    </li>
                    <li>
                        <emphcode>jsonlite</emphcode> for json
                    </li>
                    <li>
                        <emphcode>xml2</emphcode> for XML
                    </li>
                </ul>
            </section>

            <section>
                <h2>References</h2>
                <ul>
                    <li>R for DS: ch 5 - 16</li>
                    <li>https://r4ds.had.co.nz/</li>
                    <li>https://exts.ggplot2.tidyverse.org/gallery/</li>
                    <li>https://www.rstudio.com/resources/cheatsheets/</li>
                </ul>
            </section>

        </div>
    </div>

    <script src="reveal.js.4.1.3/dist/reveal.js"></script>
    <script src="reveal.js.4.1.3/plugin/zoom/zoom.js"></script>
    <script src="reveal.js.4.1.3/plugin/notes/notes.js"></script>
    <script src="reveal.js.4.1.3/plugin/search/search.js"></script>
    <script src="reveal.js.4.1.3/plugin/markdown/markdown.js"></script>
    <script src="reveal.js.4.1.3/plugin/highlight/highlight.js"></script>
    <script src="reveal.js.4.1.3/plugin/math/math.js"></script>

    <script>
        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: false,
            progress: true,
            center: true,
            hash: true,
            transition: 'slide', // none/fade/slide/convex/concave/zoom

            width: 1024,
            height: 768,

            slideNumber: 'c/t',

            math: {
                // mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                config: 'TeX-AMS_HTML-full',
                TeX: {
                    Macros: {
                        R: '\\mathbb{R}',
                        set: ['\\left\\{#1 \\; ; \\; #2\\right\\}', 2]
                    }
                }
            },

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealMath, RevealHighlight]
        });

    </script>

</body>

</html>